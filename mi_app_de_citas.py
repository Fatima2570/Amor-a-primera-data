# -*- coding: utf-8 -*-
"""mi_app_de_citas

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1UcvVKqphG_csJ7ktFoZMXD7ONxvX0zAn
"""

pip install streamlit

import streamlit as st
import pandas as pd
import random

st.set_page_config(page_title="ğŸ’˜ Amor A Primera Data ğŸ’˜")

st.title("ğŸ’˜ Amor A Primera Data ğŸ’˜")
st.caption("Encuentra el match perfecto basado en tus gustos, valores y estilo de vida.")

# Ruta de la base de datos
DATA_PATH = "/content/drive/MyDrive/match_data.csv"

# Cargar o crear base de datos
try:
    db = pd.read_csv(DATA_PATH)
except FileNotFoundError:
    db = pd.DataFrame(columns=[
        'Correo', 'Nombre', 'Edad', 'GÃ©nero', 'GÃ©nero_Buscado', 'Signo',
        'Instagram', 'RelaciÃ³n', 'Hobbies', 'Hijos', 'Altura',
        'Altura_Buscada', 'ReligiÃ³n', 'Universidad', 'Carrera', 'Rango_Edad'
    ])
    db.to_csv(DATA_PATH, index=False)

# Compatibilidad zodiacal bÃ¡sica
compat_zodiaco = {
    "Aries": ["Leo", "Sagitario", "GÃ©minis"],
    "Tauro": ["Virgo", "Capricornio", "CÃ¡ncer"],
    "GÃ©minis": ["Libra", "Acuario", "Aries"],
    "CÃ¡ncer": ["Escorpio", "Piscis", "Tauro"],
    "Leo": ["Aries", "Sagitario", "Libra"],
    "Virgo": ["Tauro", "Capricornio", "Escorpio"],
    "Libra": ["GÃ©minis", "Acuario", "Leo"],
    "Escorpio": ["CÃ¡ncer", "Piscis", "Virgo"],
    "Sagitario": ["Aries", "Leo", "Acuario"],
    "Capricornio": ["Tauro", "Virgo", "Piscis"],
    "Acuario": ["GÃ©minis", "Libra", "Sagitario"],
    "Piscis": ["CÃ¡ncer", "Escorpio", "Capricornio"]
}

def calcular_compatibilidad(persona, user_data):
    puntos = 0
    if user_data['GÃ©nero'] in persona["GÃ©nero_Buscado"].split(";") and persona["GÃ©nero"] in user_data['GÃ©nero_Buscado'].split(";"):
        puntos += 1
    if persona["RelaciÃ³n"] == user_data['RelaciÃ³n']:
        puntos += 1
    if persona["Hijos"] == user_data['Hijos']:
        puntos += 1
    if user_data['ReligiÃ³n'] == persona["ReligiÃ³n"]:
        puntos += 1
    if user_data['Signo'] in compat_zodiaco.get(persona["Signo"], []):
        puntos += 1
    if user_data['Altura_Buscada'] == "Misma altura" and abs(user_data['Altura'] - persona["Altura"]) <= 5:
        puntos += 1
    elif user_data['Altura_Buscada'] == "MÃ¡s alto" and persona["Altura"] > user_data['Altura']:
        puntos += 1
    elif user_data['Altura_Buscada'] == "MÃ¡s bajo" and persona["Altura"] < user_data['Altura']:
        puntos += 1
    hobbies_en_comun = set(user_data['Hobbies'].split(";")).intersection(set(persona["Hobbies"].split(";")))
    puntos += len(hobbies_en_comun)
    edad_dif = int(persona["Edad"]) - int(user_data['Edad'])
    if user_data['Rango_Edad'] == "Misma edad" and abs(edad_dif) == 0:
        puntos += 1
    elif user_data['Rango_Edad'] == "Hasta 5 aÃ±os mÃ¡s" and 0 < edad_dif <= 5:
        puntos += 1
    elif user_data['Rango_Edad'] == "Hasta 5 aÃ±os menos" and -5 <= edad_dif < 0:
        puntos += 1
    return puntos

def mostrar_matches(correo):
    usuario = db[db['Correo'] == correo]
    if usuario.empty:
        st.warning("âš ï¸ No encontramos tu correo en nuestra base de datos.")
        return

    user_data = usuario.iloc[0].to_dict()
    posibles_matches = db[db["Correo"] != correo].copy()

    if posibles_matches.empty:
        st.info("AÃºn no hay mÃ¡s personas registradas. Â¡Invita a tus amig@s!")
        return

    posibles_matches["compatibilidad"] = posibles_matches.apply(lambda x: calcular_compatibilidad(x, user_data), axis=1)
    mejores = posibles_matches[posibles_matches["compatibilidad"] >= 4].sort_values("compatibilidad", ascending=False)

    if not mejores.empty:
        st.markdown("### ğŸ’ Â¡Tus matches compatibles!")
        for _, match in mejores.iterrows():
            st.markdown(f"**ğŸ‘¤ Nombre:** {match['Nombre']}  \n"
                        f"ğŸ“ Universidad: {match['Universidad']}  \n"
                        f"ğŸ“š Carrera: {match['Carrera']}  \n"
                        f"ğŸ“² Instagram: {match['Instagram']}  \n"
                        f"ğŸŒŸ Compatibilidad: {match['compatibilidad']} puntos")
    else:
        st.info("TodavÃ­a no hay personas que hagan match contigo. Â¡Pronto llegarÃ¡ alguien!")

# Elegir modo
modo = st.radio("Â¿QuÃ© deseas hacer?", ["Completar formulario", "Ver mis matches anteriores"])

if modo == "Ver mis matches anteriores":
    correo_consulta = st.text_input("Ingresa tu correo para ver tus matches")
    if st.button("Ver matches"):
        mostrar_matches(correo_consulta)

else:
    st.subheader("ğŸ“‹ Completa tu perfil")

    with st.form("form_usuario"):
        correo = st.text_input("Correo electrÃ³nico (usado para evitar duplicados)", placeholder="ejemplo@gmail.com")
        nombre = st.text_input("Nombre")
        edad = st.slider("Edad", 18, 60)

        genero = st.selectbox("Â¿Con quÃ© gÃ©nero te identificas?", ["Hombre", "Mujer", "Otro"])
        genero_buscado = st.multiselect("Â¿QuÃ© gÃ©nero(s) buscas?", ["Hombre", "Mujer"])

        signo = st.selectbox("Signo zodiacal", [
            "Aries", "Tauro", "GÃ©minis", "CÃ¡ncer", "Leo", "Virgo",
            "Libra", "Escorpio", "Sagitario", "Capricornio", "Acuario", "Piscis"
        ])

        instagram = st.text_input("Tu Instagram (opcional)")
        relacion = st.radio("Â¿QuÃ© tipo de relaciÃ³n buscas?", ["Seria", "Casual"])

        hobbies = st.multiselect("Selecciona tus hobbies", [
            "Leer", "Bailar", "Cocinar", "Viajar", "Jugar videojuegos", "Hacer deporte",
            "Ver pelÃ­culas", "Escuchar mÃºsica", "Escribir", "Arte", "Naturaleza"
        ])

        hijos = st.radio("Â¿Quieres tener hijos?", ["SÃ­", "No"])
        altura = st.number_input("Â¿CuÃ¡l es tu altura? (en cm)", min_value=100, max_value=250)
        altura_buscada = st.selectbox("Â¿QuÃ© altura prefieres en tu pareja?", [
            "Misma altura", "MÃ¡s alto", "MÃ¡s bajo"
        ])

        religion = st.selectbox("Â¿CuÃ¡l es tu religiÃ³n?", ["Creyente", "Ateo", "AgnÃ³stico"])
        universidad = st.text_input("Â¿En quÃ© universidad o instituto estudias?")
        carrera = st.text_input("Â¿QuÃ© carrera estudias?")

        rango_edad = st.selectbox("Â¿QuÃ© rango de edad aceptarÃ­as para tu pareja?", [
            "Misma edad", "Hasta 5 aÃ±os mÃ¡s", "Hasta 5 aÃ±os menos"
        ])

        submit = st.form_submit_button("Buscar pareja ğŸ’˜")

    if submit:
        if correo in db["Correo"].values:
            st.warning("âš ï¸ Ya hay una cuenta registrada con este correo. Si quieres ver tus matches, usa la opciÃ³n correspondiente arriba.")
        else:
            nuevo_usuario = {
                "Correo": correo,
                "Nombre": nombre,
                "Edad": edad,
                "GÃ©nero": genero,
                "GÃ©nero_Buscado": ";".join(genero_buscado),
                "Signo": signo,
                "Instagram": instagram,
                "RelaciÃ³n": relacion,
                "Hobbies": ";".join(hobbies),
                "Hijos": hijos,
                "Altura": altura,
                "Altura_Buscada": altura_buscada,
                "ReligiÃ³n": religion,
                "Universidad": universidad,
                "Carrera": carrera,
                "Rango_Edad": rango_edad
            }

            db = db.append(nuevo_usuario, ignore_index=True)
            db.to_csv(DATA_PATH, index=False)
            st.success("âœ… Â¡Tu informaciÃ³n ha sido registrada correctamente!")
            mostrar_matches(correo)